# エラー型を設計し、ハンドラーの戻り値を整理する

Issue: #8

## チェックリスト

- [ ] [AppError と AppResult を定義する](#apperror-と-appresult-を定義する)
- [ ] [ハンドラーの戻り値を Result に変更する](#ハンドラーの戻り値を-result-に変更する)
- [ ] [CLI でハンドラーの結果を自動表示する仕組みを作る](#cli-でハンドラーの結果を自動表示する仕組みを作る)

## 未決

（なし）

## 方針

### AppError と AppResult を定義する

#### 方針

- thiserror で `AppError` enum を shared クレートに定義する
- `AppResult<T> = Result<T, AppError>` 型エイリアスを用意する
- エラーのバリアントは具体的なケースが出てきた時に追加する。先回りして列挙しない
- ただし、予期しない内部エラーを受ける汎用バリアント（`InternalError` 等）は最初から用意する。HTTP の 500 に相当するもの
- axum の `IntoResponse` のような HTTP 固有の変換は不要
- HTTP ステータスコードのような成功/失敗の汎用表現も不要。`Result<T, E>` の型自体が役割を果たす（`Ok(Session)` = 作成成功、`Ok(())` = 完了、`Err(AppError)` = 失敗）
- anyhow はエントリポイント（`main` 関数）の初期化処理とテストで使う。ビジネスロジック（ハンドラー・リポジトリ）では使わない

#### 実装方法

- shared クレートに `AppError` と `AppResult` を定義
- `AppError` は `serde::Serialize` を derive する。Tauri の `#[tauri::command]` は `Result<T, E>` の `E` が `Serialize` を実装していれば自動で JSON に変換してフロントエンドの `catch` に渡す。そのため Tauri 側で変換コードは不要
- CLI 側は `Display`（thiserror が自動生成）で表示する

### ハンドラーの戻り値を Result に変更する

#### 方針

- api のハンドラーが `String` ではなく `AppResult<T>` を返すようにする
- health check の戻り値は `AppResult<bool>` にする

#### 実装方法

- api クレートに shared への依存を追加
- `health_check` の戻り値を `AppResult<bool>` に変更
- CLI 側で `Result` を受け取り、`Ok` なら値を表示、`Err` ならエラーメッセージを表示

### CLI でハンドラーの結果を自動表示する仕組みを作る

#### 方針

- ハンドラーの呼び出しだけ書けば結果が自動で表示されるようにする
- ハンドラーは値を返すだけで、表示の責任は持たない（Tauri からも呼ばれるため）

#### 実装方法

- CLI 側に `AppResult<T>` を受け取って `Ok` なら値を表示、`Err` ならエラーを表示する汎用的な仕組みを用意する
- `T` は `Display` を実装している前提
