# スロット管理

## 概要

worktree に gitignore されたファイルを持ち込めない問題を解決する仕組み。
スロットにテンプレートファイルやコマンドを登録し、セッション作成時に自動で配置・実行する。
Docker に限らず、.env や .envrc 等あらゆる gitignore されたファイルに対応する。

## スロット定義

スロットが持つ情報：

| 項目 | 説明 |
| --- | --- |
| ID | スロットの一意識別子 |
| ラベル | スロットの名前（セッション一覧やカードに表示） |
| 色 | セッションカードの枠の色 |
| 排他 | true: 同時に1セッションのみ使用可 / false: 複数セッションで共有可 |
| テンプレートファイル | worktree に配置するファイル群 |
| 作成時コマンド | セッション作成時に実行するコマンド |
| 削除時コマンド | セッション削除時に実行するコマンド |

## テンプレートファイル

- スロットに複数のファイルを登録できる
- 各ファイルはパス（worktree からの相対パス）と内容を持つ
- 例: `.env`、`docker-compose.override.yml`、`.tool-versions`、`.envrc`
- セッション作成時に worktree ディレクトリに配置される

## 作成時コマンド

- セッション作成時、テンプレートファイル配置後に実行される
- 作業ディレクトリは worktree のパス
- 例: `rails db:create db:migrate db:seed`

## 削除時コマンド

- セッション削除時、worktree 削除前に実行される
- 作業ディレクトリは worktree のパス
- 例: `docker compose down`、`docker volume rm`

## 排他/共有

スロット作成時に排他か共有かを設定する。

- **排他スロット**: 同時に1つのセッションだけが使える。セッション作成モーダルでは使用中の排他スロットは選択不可として表示する。セッション削除時に解放される。使用中かどうかはセッション一覧の `slot_id` から逆引きで判定する（スロット側に状態を持たない）
- **共有スロット**: 複数セッションが同じスロットを使える。解放の概念なし

## 設定 UI

- セッション作成モーダルからスロット作成モーダルを開ける
- セッション情報モーダルのスロットラベルからスロット編集モーダルを開ける
- テンプレートファイルの内容はモーダル内で編集できる
- スロットの削除はスロット編集モーダルから行う
