# データモデル

## プロジェクト

全データはプロジェクト（リポジトリ）単位で管理する。
`tvine .` で起動したディレクトリの git ルートパスからプロジェクト識別子を生成し、データを分離する。
識別子はパスの `/` を `-` に置き換えたもの（例: `/Users/aki/dev/myapp` → `-Users-aki-dev-myapp`）。Claude Code と同じ方式。

## セッション

| 項目 | 型 | 説明 |
| --- | --- | --- |
| id | UUID | tvine が生成。Claude Code の session-id としても使用（--session-id / --resume） |
| branch_name | string | ブランチ名 |
| base_branch | string | ベースブランチ名 |
| worktree_path | string | worktree のディレクトリパス |
| slot_id | string? | 紐づくスロットの ID（任意） |
| created_at | datetime | 作成日時 |

## スロット

| 項目 | 型 | 説明 |
| --- | --- | --- |
| id | string | スロットの一意識別子 |
| label | string | 表示ラベル |
| color | string | カード枠の色 |
| exclusive | boolean | true: 排他（同時に1セッションのみ） / false: 共有 |
| template_files | array | テンプレートファイル（パスと内容のペア） |
| on_create_command | string? | 作成時コマンド |
| on_delete_command | string? | 削除時コマンド |

## ステータス

hook スクリプトが更新する。セッションデータとは別ファイルで管理する。
status.json が存在しない場合（セッション作成直後等）は Idle として扱う。

| 項目 | 型 | 説明 |
| --- | --- | --- |
| status | enum | Busy / Waiting / Idle |
| event | string | 最後に受け取った hook イベント名 |
| updated_at | datetime | 最終更新日時 |

## 永続化

JSON ファイル。セッション数は数個〜十数個の想定なので SQLite は不要。

## 保存場所

```tree
~/.tvine/
├── plugin/                          # Claude Code Plugin（全プロジェクト共通）
│   ├── .claude-plugin/
│   │   └── plugin.json
│   ├── hooks/
│   │   └── hooks.json
│   └── scripts/
│       └── notify.sh
└── projects/
    └── <project-id>/
        ├── sessions/
        │   ├── <session-id>/
        │   │   ├── session.json     # セッション情報
        │   │   └── status.json      # ステータス（hook が更新）
        │   └── <session-id>/
        │       ├── ...
        └── slots.json               # スロット定義（プロジェクト内で共有）
```

- 全データはプロジェクト識別子で分離される
- セッションに関するデータはセッションディレクトリにまとめる
- 削除時はディレクトリごと消せる
- slots はプロジェクト内のセッション横断

## 起動時の復元

- プロジェクト識別子からデータディレクトリを特定する
- `sessions/` 配下のディレクトリを走査して session.json を読み込む
- 各セッションの worktree が実際に存在するか検証する
- 存在しない worktree のセッションは削除または警告する
- status.json から最後のステータスを読む
